{"status":{},"contains_secrets":false,"product_version":"3.5.2","spec":{"description":"Three node Kafka Cluster. \nRefer to the marketplace description for more information. ","resources":{"client_attrs":{"None":{"y":182,"x":819},"15f245d6_deployment":{"y":182,"x":819}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kafka"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"d6b2bd64_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"52e204a7_runbook","main_task_local_reference":{"kind":"app_task","name":"d6b2bd64_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kafka"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"b3bef8fd_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"f9b8d70a_runbook","main_task_local_reference":{"kind":"app_task","name":"b3bef8fd_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kafka"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[{"kind":"app_task","name":"Start kafka"}],"name":"7d1d386d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Kafka"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"Start kafka","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\nsudo systemctl start kafka-zookeeper\nsudo systemctl start kafka","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"ee746a4e_runbook","main_task_local_reference":{"kind":"app_task","name":"7d1d386d_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kafka"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"9200b3da_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d5baf4f4_runbook","main_task_local_reference":{"kind":"app_task","name":"9200b3da_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kafka"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"71400b11_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"5d751ec5_runbook","main_task_local_reference":{"kind":"app_task","name":"71400b11_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"Kafka","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"AHV_Kafka","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"0","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"timeout_secs":true,"address":true,"delay_secs":true,"connection_port":true},"create_spec":{"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"boot_config":true,"guest_customization":true,"disk_list":{}},"name":true,"categories":true}},"os_type":"Linux","create_spec":{"name":"kafka-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","vpc_reference":null,"ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"4d2062ce-0e78-408f-a31d-da3a54dfe4f8"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\nchpasswd:\n  list: |\n    centos:@@{centos.secret}@@\n  expire: False\nssh_pwauth: true"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"8d416cfe-ae66-4856-b74d-eb2e55a0e962","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"AHV_CENTOS_78","uuid":"3c1d6440-9f28-45a8-8b21-96dbd335e364"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":{"kind":"cluster","type":"","name":"PHX-POC030","uuid":"000607a1-0609-6ea4-0000-00000000d162"},"categories":{}},"variable_list":[]}],"credential_definition_list":[{"username":"centos","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"centos","editables":{"username":true,"secret":true},"cred_class":"static"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Kafka"}],"name":"AHV_Kafka_Package","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Kafka_Package"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[{"kind":"app_task","name":"Kafka Install and Configure"}],"name":"fcf65980_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Kafka"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"Kafka Install and Configure","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n# -*- Variables and constants\nKAFKA_URL=\"@@{KAFKA_URL}@@\"\nZOOKEEPER_DATA_DIR=\"@@{ZOOKEEPER_DATA_DIR}@@\"\nARRAY_ADDRESS=\"@@{calm_array_address}@@\"\nKAFKA_LOG_DIRS=\"@@{KAFKA_LOG_DIRS}@@\"\nNUMBER_OF_PARTITIONS=\"@@{NUMBER_OF_PARTITIONS}@@\"\n\nID=$((@@{calm_array_index}@@+1))\nfor ip in $(echo \"${ARRAY_ADDRESS}\" | tr \",\" \"\\n\"); do\n  CON+=\"${ip}:2181,\"\ndone\nZOOKEEPER_CONNECT=$(echo $CON | sed  's\/,$\/\/')\n\nsudo yum -y --quiet update\n\n# -*- Install zookeeper and kafka\nsudo yum install -y --quiet java-1.8.0-openjdk.x86_64 wget\n\nsudo wget \"${KAFKA_URL}\" -O \/opt\/kafka.tgz\ncd \/opt\/\nsudo chmod a+x kafka.tgz\nsudo mkdir -p kafka\nsudo tar -xzf kafka.tgz -C kafka\/\nsudo mv \/opt\/kafka\/kafka_*\/* \/opt\/kafka\/\n\n# -*- Configure zookeeper and kafka\nsudo echo  \"[Unit]\nDescription=Apache Zookeeper server (Kafka)\nDocumentation=http:\/\/zookeeper.apache.org\nRequires=network.target remote-fs.target\nAfter=network.target remote-fs.target\n\n[Service]\nType=simple\nUser=root\nGroup=root\nEnvironment=JAVA_HOME=\/usr\/lib\/jvm\/jre-1.8.0-openjdk\nExecStart=\/opt\/kafka\/bin\/zookeeper-server-start.sh \/opt\/kafka\/config\/zookeeper.properties\nExecStop=\/opt\/kafka\/bin\/zookeeper-server-stop.sh\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee -a \/etc\/systemd\/system\/kafka-zookeeper.service\n\nsudo echo \"[Unit]\nDescription=Apache Kafka server (broker)\nDocumentation=http:\/\/kafka.apache.org\/documentation.html\nRequires=network.target remote-fs.target\nAfter=network.target remote-fs.target kafka-zookeeper.service\n\n[Service]\nType=simple\nUser=root\nGroup=root\nEnvironment=JAVA_HOME=\/usr\/lib\/jvm\/jre-1.8.0-openjdk\nExecStart=\/opt\/kafka\/bin\/kafka-server-start.sh \/opt\/kafka\/config\/server.properties\nExecStop=\/opt\/kafka\/bin\/kafka-server-stop.sh\" | sudo tee -a \/etc\/systemd\/system\/kafka.service\n\ncount=0\nfor ip in $(echo \"${ARRAY_ADDRESS}\" | tr \",\" \"\\n\"); do\n  count=$((count+1))\n  if [[ \"${ip}\" == \"@@{address}@@\" ]]; then\n  \tip=\"0.0.0.0\"\n  fi\n  echo \"server.${count}=${ip}:2888:3888\" | sudo tee -a \/opt\/kafka\/config\/zookeeper.properties\ndone\n\necho \"initLimit=5\nsyncLimit=2\" | sudo tee -a \/opt\/kafka\/config\/zookeeper.properties\n\nsudo sed -i \"s#dataDir=\\\/tmp\\\/zookeeper#dataDir=${ZOOKEEPER_DATA_DIR}#\" \/opt\/kafka\/config\/zookeeper.properties\nmkdir -p ${ZOOKEEPER_DATA_DIR}\necho ${ID} | sudo tee \"${ZOOKEEPER_DATA_DIR}\/myid\"\nsudo sed -i \"s\/broker.id=0\/broker.id=${ID}\/g\" \/opt\/kafka\/config\/server.properties\nsudo sed -i \"s\/num.partitions=1\/num.partitions=${NUMBER_OF_PARTITIONS}\/\" \/opt\/kafka\/config\/server.properties\nsudo sed -i \"s\/zookeeper.connect=localhost:2181\/zookeeper.connect=${ZOOKEEPER_CONNECT}\/\" \/opt\/kafka\/config\/server.properties\nsudo sed -i \"s#log.dirs=\\\/tmp\\\/kafka-logs#log.dirs=${KAFKA_LOG_DIRS}#g\" \/opt\/kafka\/config\/server.properties\nsudo sed -i \"s%#listeners=PLAINTEXT:\/\/:9092%listeners=PLAINTEXT:\/\/@@{address}@@:9092%\" \/opt\/kafka\/config\/server.properties\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"da0aa606_runbook","main_task_local_reference":{"kind":"app_task","name":"fcf65980_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Kafka_Package"},"retries":"0","description":"","inherit_target":false,"child_tasks_local_reference_list":[],"name":"4d590853_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"f813ab0e_runbook","main_task_local_reference":{"kind":"app_task","name":"4d590853_dag"},"variable_list":[]},"upgrade_runbook":{}},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"AHV_CENTOS_78","version":"","options":{"type":"","name":"CENTOS_78","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/Calm\/CentOS-7-x86_64-2003.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"ESX_CENTOS_78","version":"","options":{"type":"","name":"CENTOS_78","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/Calm\/CentOS-7-x86_64-2003.ova","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"15f245d6_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"AHV_Kafka_Package"}],"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Kafka"},"variable_list":[],"description":""}],"environment_reference_list":[],"application_url":"","description":"","action_list":[],"name":"Nutanix","restore_config_list":[],"snapshot_config_list":[],"patch_list":[],"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"KAFKA_URL","value":"https:\/\/archive.apache.org\/dist\/kafka\/2.6.2\/kafka_2.13-2.6.2.tgz","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"ZOOKEEPER_DATA_DIR","value":"\/home\/centos\/zookeepeer\/data\/","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"KAFKA_LOG_DIRS","value":"\/var\/log\/kafka-logs","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"NUMBER_OF_PARTITIONS","value":"2","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"centos"},"type":"USER"},"name":"APR_Kafka"},"api_version":"3.0","metadata":{"last_update_time":"1697356529008904","kind":"blueprint","spec_version":1,"creation_time":"1697356481861911","categories":{"AppFamily":"BI-Productivity"},"name":"APR_Kafka"}}